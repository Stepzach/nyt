<!DOCTYPE html>
<html lang="en">
<head>
    <title>Mini Crossword</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta property="og:title" content="Mini Xword"/>
    <meta property="og:image" content=""/>
    <meta property="og:description" content="Competitive mini crossword"/>
    <meta property="og:url" content=""/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="626"/>
    <meta property="og:type" content="website"/>
    <meta name="theme-color" content="#000">
    <meta name="msapplication-navbutton-color" content="#000">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>

    <link href="style.css" rel="stylesheet">
    <script type="text/javascript" src="game.js"></script>
    <style>
        /* Prevent scrolling caused by focus */
        *:focus {
            outline: none;
        }
    </style>
     <script src="https://www.gstatic.com/firebasejs/9.6.6/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.6/firebase-database-compat.js"></script>
    <script 
        
            // Firebase App (the core Firebase SDK) is always required and
        // must be listed before other Firebase SDKs
        import { initializeApp } from 'firebase/app';
        // Add the Firebase products that you want to use
        import { getAuth } from "firebase/realtimedatabase";
         import { getAuth } from "firebase/database";
                 import { getAuth } from "firebase/app";
                 import { getAuth } from "firebase/webapp";
        import { getFirestore } from "firebase/firestore";
        
        // TODO: Replace the following with your app's Firebase project configuration
        const firebaseConfig = {
          apiKey: "AIzaSyBukFC83UnD1r6SaiSv-M95dz9PINFhqWU",
  authDomain: "crosswordleader.firebaseapp.com",
  databaseURL: "https://crosswordleader-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "crosswordleader",
  storageBucket: "crosswordleader.firebasestorage.app",
  messagingSenderId: "762979733536",
  appId: "1:762979733536:web:2f8afc76b9dc1156942c45"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

     
});

</script>
    <script src="https://www.gstatic.com/firebasejs/9.6.6/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.6/firebase-database-compat.js"></script>
     <script>

         
    const firebaseConfig = {
  apiKey: "AIzaSyBukFC83UnD1r6SaiSv-M95dz9PINFhqWU",
  authDomain: "crosswordleader.firebaseapp.com",
  databaseURL: "https://crosswordleader-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "crosswordleader",
  storageBucket: "crosswordleader.firebasestorage.app",
  messagingSenderId: "762979733536",
  appId: "1:762979733536:web:2f8afc76b9dc1156942c45"
};

</script>
     <script>
// Initialize Firebase with your config
 // 3. Initialize Firebase (AFTER SDK scripts are loaded)
        firebase.initializeApp(firebaseConfig);

        // 4. Get a reference to the database service
        const database = firebase.database();

        // 5. Define leaderboardRef globally (so it's accessible to other functions)
        const leaderboardRef = database.ref('leaderboard');
</script>
   
    
</head>
<div id="whole">
<body style="overflow: hidden; height: 100vh">
  <div class="bruhbruh" style="display: flex; flex-direction: column; height: 100%; overflow: hidden">
    <div id="overlay">
     <div id="popup">
  <label style="margin-bottom: 0;">Welcome to today's Crossword!</label>
  <p id="crosswordDate" style="margin-top: 5px; margin-bottom: 35px; color: grey; font-size: 16px;"></p>
  
  <label style="font-weight: normal !important; margin-bottom: 20px;" for="nameInput">Enter your name:</label>
  <input style="margin-bottom: 20px;" type="text" id="nameInput" /><br />
  <button onclick="startGame()" style="font-weight:bold">Start Crossword</button>
  <br>
  <p style="color:grey; font-size: 15px;"></p>
</div>

<script>
  // Function to set the date in the format "Saturday 4th Jan 2025"
  function updateCrosswordDate() {
    const dateElement = document.getElementById('crosswordDate');
    const today = new Date();
    
    // Get day of the week
    const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    const dayName = days[today.getDay()];
    
    // Get day of the month and suffix
    const day = today.getDate();
    const suffix = (day % 10 === 1 && day !== 11) ? 'st' : (day % 10 === 2 && day !== 12) ? 'nd' : (day % 10 === 3 && day !== 13) ? 'rd' : 'th';
    
    // Get month
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const monthName = months[today.getMonth()];
    
    // Get year
    const year = today.getFullYear();
    
    // Combine into the desired format
    const formattedDate = `${dayName} ${day}${suffix} ${monthName} ${year}`;
    
    // Update the date element
    dateElement.textContent = formattedDate;
  }
  
  // Call the function on page load
  updateCrosswordDate();
</script>

    </div>

    <div class="topnav">
      <div style="float: left; margin-left: 15px">
        <b id="userNameDisplay" style="font-weight: 100; font-size: 18px;"></b>
      </div>

      <div style="float: right; margin-right: 12px">
        <b id="timerDisplay" style="font-weight: 100">00:00</b>
      </div>
      
       <!-- Pause button -->
      <div style="float: right; margin-right: 22px;">
        <button id="pauseButton" style="all: unset; cursor: pointer;" onclick="togglePause()">
          <img src="4141_pause-button.png" width="13px" style="opacity:0.5;">
        </button>
      </div>
    </div>
<div id="pauseModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; border-radius: 10px; overflow: hidden;">
  <div class="modal-content" style="position: absolute; bottom: 0px; width: 100%; max-width: 455px; height: 400px;  background: white; padding: 20px; transition: bottom 0.3s; left: 50%;
    transform: translateX(-50%); text-align: center;">
    <p style="font-size: 18px; font-weight: bold; margin-bottom: 20px;">YOUR GAME IS PAUSED</p>  <p style="font-size: 17px; margin-bottom: 2px; padding-left: 20px;  padding-right: 20px;">Take a break, and return when you're ready.</p> <p style="font-size: 15px; color: grey; margin-top: 5px; margin-bottom: 25px; padding-left: 20px; padding-right: 20px;">(Don't close the window, you will lose all progress)</p>
    <button onclick="resumeGame()" style="padding: 10px 20px; font-size: 18px; font-weight: bold; color: black; background-color: rgb(153, 218, 255); border: medium; border-radius: 5px; cursor: pointer; transition: background-color 0.3s;" onmouseover="this.style.backgroundColor='#FFD800'" onmouseout="this.style.backgroundColor='#99DAFF'">RESUME</button>
  </div>
</div>



    <br />

    <table id="table"></table>

    <div class="keysize1">
      <div id="bruh" style="">
        <div id="hint-container">
          <button id="prev-hint" onclick="scrollHint(-1)"> < </button>
          <span id="hint-text" style="font-size: 16px"></span>
          <button id="next-hint" onclick="scrollHint(1)"> > </button>
        </div>

        <div id="keyboard">
          <div class="keyboard-row">
            <button onclick="insertChar('Q')">Q</button>
            <button onclick="insertChar('W')">W</button>
            <button onclick="insertChar('E')">E</button>
            <button onclick="insertChar('R')">R</button>
            <button onclick="insertChar('T')">T</button>
            <button onclick="insertChar('Y')">Y</button>
            <button onclick="insertChar('U')">U</button>
            <button onclick="insertChar('I')">I</button>
            <button onclick="insertChar('O')">O</button>
            <button onclick="insertChar('P')">P</button>
          </div>
          <div class="keyboard-row">
            <button onclick="insertChar('A')">A</button>
            <button onclick="insertChar('S')">S</button>
            <button onclick="insertChar('D')">D</button>
            <button onclick="insertChar('F')">F</button>
            <button onclick="insertChar('G')">G</button>
            <button onclick="insertChar('H')">H</button>
            <button onclick="insertChar('J')">J</button>
            <button onclick="insertChar('K')">K</button>
            <button onclick="insertChar('L')">L</button>
          </div>
          <div class="keyboard-row">
            <button onclick="insertChar('Z')">Z</button>
            <button onclick="insertChar('X')">X</button>
            <button onclick="insertChar('C')">C</button>
            <button onclick="insertChar('V')">V</button>
            <button onclick="insertChar('B')">B</button>
            <button onclick="insertChar('N')">N</button>
            <button onclick="insertChar('M')">M</button>
            <button onclick="deleteChar()" style="background-color: lightgray; font-size: 23px">
              <img src="backspace-icon-2048x1714-fco8gl58.png" width="20px" />
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
    <!-- Congratulations Popup -->
    <!-- Congratulations Popup -->
    <div id="congratsModal" class="modal" style="display: none; position: absolute; bottom: 0px; width: 100%; max-width: 495px; height: 500px; background-color: white; border-radius: 10px; text-align: center; z-index: 1001; box-shadow: rgba(0,0,0,0.2);">
    <div style="display: flex; justify-content: flex-end; padding: 10px;">
        <span id="closeButton" style="cursor: pointer; font-size: 20px;">x</span>
    </div>
    <div class="modal-content" style="padding: 0px 30px 30px 30px;">
        <h2>Congratulations!</h2>
        <p id="completionMessage">You have successfully completed the crossword.</p>
        <p style="color: grey; font-size: 15px;">Come back for tomorow's crossword!</p>
        <button onclick="location.href='./leaderboard.html';" style="background-color: #99DAFF; color: black; padding: 12px 20px; font-size: 16px; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease;" onmouseover="this.style.backgroundColor='#FFD800'" onmouseout="this.style.backgroundColor='#99DAFF'">See Leaderboard</button>
    </div>
</div>

<div id="minimizedCongrats" style="display: none; position: fixed; bottom: 0; width: 100%; max-width: 475px; text-align: center; background-color: white; padding: 10px; border-top: 1px solid #ccc; z-index: 1001;">
    <span id="expandButton" style="cursor: pointer; font-size: 20px;">^</span>
    Congratulations!
</div>

<script>
    const congratsModal = document.getElementById('congratsModal');
    const closeButton = document.getElementById('closeButton');
    const expandButton = document.getElementById('expandButton');
    const minimizedCongrats = document.getElementById('minimizedCongrats');
    const modalContent = congratsModal.querySelector('.modal-content');

    closeButton.addEventListener('click', () => {
        congratsModal.style.display = 'none';
        minimizedCongrats.style.display = 'block';
    });

    expandButton.addEventListener('click', () => {
        congratsModal.style.display = 'block';
        minimizedCongrats.style.display = 'none';
    });
</script>

    <!-- Try Again Popup -->
    <div id="tryAgainModal" class="modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100%; max-width: 400px; background-color: white; border-radius: 10px; text-align: center; z-index: 1001; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
        <div class="modal-content" style="padding: 30px;">
            <h2>Try Again!</h2>
            <p>Your current answers are not correct. Keep trying!</p>
            <button onclick="hideTryAgainPopup()" style="background-color: #99DAFF; color: black; padding: 12px 20px; font-size: 16px; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease;" onmouseover="this.style.backgroundColor='#FFD800'" onmouseout="this.style.backgroundColor='#99DAFF'">Return to Game</button>
        </div>
    </div>

    <!-- Overlay for Popups -->
    <div id="modalOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000;"></div>

  <div id="onboard" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('onboard')">Ã—</span>
      <p><b>Wrist crosswords</b> are small 5x5 letter crosswords</p>
      <p>
        Touch the ACROSS and DOWN buttons to change the
        <b>direction</b> of writing:
      </p>
      <table bgcolor="black">
        <tr>
          <td style="background-color: gold"><input class="cell" style="opacity: 0" /></td>
          <td id="anim1"><input class="cell" style="opacity: 0" /></td>
          <td id="anim2"><input class="cell" style="opacity: 0" /></td>
          <td id="anim3"><input class="cell" style="opacity: 0" /></td>
          <td id="anim4"><input class="cell" style="opacity: 0" /></td>
        </tr>
        <tr>
          <td id="anim5"><input class="cell" style="opacity: 0" /></td>
          <td><input class="cell" /></td>
          <td><input class="cell" /></td>
          <td><input class="cell" /></td>
          <td><input class="cell" /></td>
        </tr>
      </table>
      <p>
        <button id="anim6" style="font-size: 16px">
          <b>ACROSS:</b> Sentences are made of these
        </button>
      </p>
      <button id="anim7" style="font-size: 16px">
        <b>DOWN:</b> Opposite of below
      </button>
      <p style="text-align: right" onclick="closeModal('onboard'); showModal('onboard2')">
        <button>Next</button>
      </p>
    </div>
  </div>

  <script>
  //Removed tips and acrossWords array since we are harcoding the correct answer
    
  </script>

  <script type="text/javascript" src="confetti.js"></script>
  <script>
    // Global variables
    let horizontal = true;
    let maxscore = 100;
    let x, y;
    let currentHintIndex = 0;
    let directionMap = {};
    let startTime;
    let timerInterval;
    let isPaused = false;
    let pausedTime = 0; // To store the elapsed time when the game is paused
    let score = 0;

    // --- Helper Functions ---
    function closeModal(name) {
      document.getElementById(name).style.display = "none";
    }

    function showModal(name) {
      document.getElementById(name).style.display = "block";
    }

    function animTutorial() {
        let animState = document.getElementById("anim1").style.backgroundColor === "LightBlue";
        const cells = ["anim1", "anim2", "anim3", "anim4"];

        cells.forEach(id => {
            document.getElementById(id).style.backgroundColor = animState ? "White" : "LightBlue";
        });

        document.getElementById("anim5").style.backgroundColor = animState ? "LightBlue" : "White";
        document.getElementById("anim6").style.backgroundColor = animState ? "LightGray" : "LightBlue";
        document.getElementById("anim7").style.backgroundColor = animState ? "LightBlue" : "LightGray";
    }

    function updateHintText() {
      const hintTextElement = document.getElementById("hint-text");
        // Update hint text based on the current direction and cell
        if (horizontal) {
            const acrossHints = [
                "Not a verb, adjective, or adverb", 
                "It's on the ____ (free)", 
                "Landlord; possessor; proprietor", 
                "Opposite of micro", 
                "They're rolled in annoyance",
               

            ];
            hintTextElement.textContent = acrossHints[x] || "";
        } else {
            const downHints = [
                "Where the heart is", 
                "Absolutely not!", 
                "American unit of measurement (roughly equal to 28 grams)", 
                "App customers", 
                "Infamous ruler of Rome",
               
            ];
            hintTextElement.textContent = downHints[y] || "";
        }
    }

    function colorSquares() {
        for (let i = 0; i < 5; i++) {
            for (let j = 0; j < 5; j++) {
                let cell = document.getElementById(`i${i}_${j}`);
                // Determine if the cell should be black based on the position
                let isBlackCell = (i === 0 && j === 0) || (i === 4 && j === 4);
                cell.style.backgroundColor = isBlackCell ? "black" : "white";
            }
        }
        
let lastClickedCellId = null; // Track the last clicked cell
        let start, end;
        if (horizontal) {
            start = 0;
            end = 5;

            for (let i = start; i < end; i++) {
                let cell = document.getElementById("i" + x + "_" + i);
                if (cell && !cell.classList.contains('black-cell')) {
                    cell.style.backgroundColor = "#99DAFF"; // Light blue for the current word
                }
            }
        } else {
            start = 0;
            end = 5;

            for (let i = start; i < end; i++) {
                let cell = document.getElementById("i" + i + "_" + y);
                if (cell && !cell.classList.contains('black-cell')) {
                    cell.style.backgroundColor = "#99DAFF";
                }
            }
        }

        // Highlight the currently selected cell
        if (document.getElementById("i" + x + "_" + y) && !document.getElementById("i" + x + "_" + y).classList.contains('black-cell')) {
            document.getElementById("i" + x + "_" + y).style.backgroundColor = "#FFD800"; // Yellow for the selected cell
        }
    }

    function initializeGame() {
      const table = document.getElementById("table");
      let tableHTML = "";
      for (let i = 0; i < 5; i++) {
        tableHTML += "<tr>";
        for (let j = 0; j < 5; j++) {
            const cellId = `i${i}_${j}`;
            // Determine if the cell should be black (disabled)
            const isBlackCell = (i === 0 && j === 0) || (i === 4 && j === 4);

            tableHTML += `<td><div style="position:relative;">
                            <input 
                                autocomplete='off' 
                                readonly 
                                onkeyup='handleKeyUp(event, ${i}, ${j})' 
                                onfocus='handleFocus(${i}, ${j})' 
                                onclick='handleCellClick(${i}, ${j})' 
                                class='cell ${isBlackCell ? 'black-cell' : ''}' 
                                id='${cellId}'
                                ${isBlackCell ? "disabled" : ""}
                            >
                            <span class="cell-number">${
                                (i === 0 && j === 1) ? "1" :
                                (i === 0 && j === 2) ? "2" :
                                (i === 0 && j === 3) ? "3" :
                                (i === 0 && j === 4) ? "4" :
                                (i === 1 && j === 0) ? "5" :
                                (i === 2 && j === 0) ? "6" :
                                (i === 3 && j === 0) ? "7" :
                                (i === 4 && j === 0) ? "8" : ""
                            }</span>
                        </div></td>`;
        }
        tableHTML += "</tr>";
    }
      table.innerHTML = tableHTML;

      // Initial setup
        x = 0;
        y = 1;
        document.getElementById(`i${x}_${y}`).focus();
      colorSquares();
      updateHintText();
      adjustSizes()
    }

    // --- Event Handlers ---
    function handleKeyUp(event, i, j) {
        const currentCell = document.getElementById(`i${i}_${j}`);

        // Handle letter input
        if (event.key.length === 1 && event.key.match(/[a-zA-Z]/)) {
            currentCell.value = event.key.toUpperCase();
            
            moveFocusToNextCell(i, j);
        }
        // Handle backspace
        else if (event.key === "Backspace") {
            if (currentCell.value === "") {
                moveFocusToPreviousCell(i, j);
            }
            currentCell.value = "";
            currentCell.style.color = "black";
        }
        // Handle arrow keys
        else if (["ArrowLeft", "ArrowRight", "ArrowUp", "ArrowDown"].includes(event.key)) {
            moveFocusWithArrowKeys(event.key, i, j);
        }

        colorSquares();
        updateHintText();
        // Only check solution if all cells are filled
        if (isPuzzleFilled()) {
            checkSolution();
        }

       
    }

    function handleFocus(i, j) {
        x = i;
        y = j;
        colorSquares();
        updateHintText();
    }



function handleCellClick(clickedX, clickedY) {
    const cellId = `i${clickedX}_${clickedY}`;
    const cell = document.getElementById(cellId);

    if (cell.disabled) return;

    // If a different cell is clicked, reset its state
    if (lastClickedCellId && lastClickedCellId !== cellId) {
        const lastCell = document.getElementById(lastClickedCellId);
        if (lastCell) {
            lastCell.dataset.clickCount = "0"; // Reset click count
            delete directionMap[lastClickedCellId]; // Reset direction
        }
    }

    let clickCount = parseInt(cell.dataset.clickCount) || 0;
    let cellHorizontal = directionMap[cellId] === "across";

    // First click logic
    if (clickCount === 0) {
        clickCount = 1;
        if (clickedX === 0) {
            cellHorizontal = isWordFilled('down', clickedX, clickedY);
        } else if (clickedY === 0) {
            cellHorizontal = !isWordFilled('across', clickedX, clickedY);
        } else { 
            cellHorizontal = true; // Default to horizontal
        }
    } else {
        // Toggle logic (and special case for first row/column)
        if ((clickedX === 0 || clickedY === 0) && clickCount === 1) {
            cellHorizontal = !cellHorizontal;
            clickCount = 0; // Reset after toggle
        } else {
            cellHorizontal = !cellHorizontal;
        }
        clickCount++;
    }

    // Update cell data and global variables
    directionMap[cellId] = cellHorizontal ? "across" : "down";
    cell.dataset.clickCount = clickCount;
    horizontal = cellHorizontal;

    // Update last clicked cell ID
    lastClickedCellId = cellId;

    // Other logic
    x = clickedX;
    y = clickedY;
    cell.focus();
    updateHintText();
    colorSquares();
}


// Initialize lastClickedCellId outside the function
let lastClickedCellId = null;

    function isWordFilled(direction, startX, startY) {
        if (direction === 'across') {
            for (let j = 0; j < 5; j++) {
                const cell = document.getElementById(`i${startX}_${j}`);
                if (!cell || cell.disabled || cell.value === "") return false;
            }
        } else { // direction === 'down'
            for (let i = 0; i < 5; i++) {
                const cell = document.getElementById(`i${i}_${startY}`);
                if (!cell || cell.disabled || cell.value === "") return false;
            }
        }
        return true;
    }

    function insertChar(char) {
        const currentCell = document.getElementById(`i${x}_${y}`);
        if (!currentCell.disabled) {
            currentCell.value = char;
           
            moveFocusToNextCell(x, y);
            colorSquares();
            updateHintText();
            // Only check solution if all cells are filled
            if (isPuzzleFilled()) {
                checkSolution();
            }
           
        }
    }

    function deleteChar() {
        const currentCell = document.getElementById(`i${x}_${y}`);
        if (!currentCell.disabled) {
            if (currentCell.value === "") {
                moveFocusToPreviousCell(x, y);
            }
            currentCell.value = "";
            currentCell.style.color = "black";
            colorSquares();
            updateHintText();
        }
    }

    function scrollHint(direction) {
      currentHintIndex = horizontal ? x : y + 5;
      currentHintIndex += direction;

      if (currentHintIndex < 0) {
          currentHintIndex = 9;
          horizontal = false;
      } else if (currentHintIndex > 9) {
          currentHintIndex = 0;
          horizontal = true;
      }

      // Switch to down direction when hint index is between 5 and 9 (inclusive)
      if (currentHintIndex >= 5 && currentHintIndex <= 9) {
          horizontal = false;
      } else {
          horizontal = true;
      }

      // Update x and y based on the direction
      if (horizontal) {
          // Across: x stays the same, y might move to the beginning of the row
          x = currentHintIndex;
          y = 0; // Start from the first cell of the row for across
      } else {
          // Down: x moves to the top of the column, y stays the same
          x = 0; // Start from the first cell of the column for down
          y = currentHintIndex - 5;
      }

      // Find the first non-disabled cell in the row (for across) or column (for down)
      if (horizontal) {
          for (let tempY = 0; tempY < 5; tempY++) {
              if (!document.getElementById(`i${x}_${tempY}`).disabled) {
                  y = tempY;
                  break;
              }
          }
      } else {
          for (let tempX = 0; tempX < 5; tempX++) {
              if (!document.getElementById(`i${tempX}_${y}`).disabled) {
                  x = tempX;
                  break;
              }
          }
      }

      // Additional check in case the above logic fails to find a non-disabled cell
      while (document.getElementById(`i${x}_${y}`).disabled) {
          if (horizontal) {
              y++;
              if (y > 4) {
                  y = 0;
                  x++;
              }
          } else {
              x++;
              if (x > 4) {
                  x = 0;
                  y++;
              }
          }
          if (x > 4 || y > 4) {
              x = 0;
              y = 0;
          }
      }

      colorSquares();
      updateHintText();
      document.getElementById(`i${x}_${y}`).focus();
    }

    // --- Navigation Functions ---
    function moveFocusToNextCell(i, j) {
        let nextCellFound = false;
        if (horizontal) {
            for (let newY = j + 1; newY < 5 && !nextCellFound; newY++) {
                if (!document.getElementById(`i${i}_${newY}`).disabled) {
                    x = i;
                    y = newY;
                    nextCellFound = true;
                }
            }
            if (!nextCellFound) {
                for (let newX = i + 1; newX < 5 && !nextCellFound; newX++) {
                    for (let newY = 0; newY < 5 && !nextCellFound; newY++) {
                        if (!document.getElementById(`i${newX}_${newY}`).disabled) {
                            x = newX;
                            y = newY;
                            nextCellFound = true;
                            horizontal = true;
                        }
                    }
                }
            }
        } else {
            for (let newX = i + 1; newX < 5 && !nextCellFound; newX++) {
                if (!document.getElementById(`i${newX}_${j}`).disabled) {
                    x = newX;
                    y = j;
                    nextCellFound = true;
                }
            }
            if (!nextCellFound) {
                for (let newY = j + 1; newY < 5 && !nextCellFound; newY++) {
                    for (let newX = 0; newX < 5 && !nextCellFound; newX++) {
                        if (!document.getElementById(`i${newX}_${newY}`).disabled) {
                            x = newX;
                            y = newY;
                            nextCellFound = true;
                            horizontal = false;
                        }
                    }
                }
            }
        }

        if (nextCellFound) {
            document.getElementById(`i${x}_${y}`).focus();
        }
    }

    function moveFocusToPreviousCell(i, j) {
        let prevCellFound = false;
        if (horizontal) {
            for (let newY = j - 1; newY >= 0 && !prevCellFound; newY--) {
                if (!document.getElementById(`i${i}_${newY}`).disabled) {
                    x = i;
                    y = newY;
                    prevCellFound = true;
                }
            }
        } else {
            for (let newX = i - 1; newX >= 0 && !prevCellFound; newX--) {
                if (!document.getElementById(`i${newX}_${j}`).disabled) {
                    x = newX;
                    y = j;
                    prevCellFound = true;
                }
            }
        }

        if (prevCellFound) {
            document.getElementById(`i${x}_${y}`).focus();
        }
    }

    function moveFocusWithArrowKeys(key, i, j) {
        if (key === "ArrowLeft" && y > 0) {
            y--;
        } else if (key === "ArrowRight" && y < 4) {
            y++;
        } else if (key === "ArrowUp" && x > 0) {
            x--;
        } else if (key === "ArrowDown" && x < 4) {
            x++;
        }

        // Skip disabled cells
        while (document.getElementById(`i${x}_${y}`).disabled) {
            if (key === "ArrowLeft" && y > 0) {
                y--;
            } else if (key === "ArrowRight" && y < 4) {
                y++;
            } else if (key === "ArrowUp" && x > 0) {
                x--;
            } else if (key === "ArrowDown" && x < 4) {
                x++;
            }
        }

        document.getElementById(`i${x}_${y}`).focus();
    }

    // --- Game Logic Functions ---
    function checkLetter(i, j, letter) {
        // Define the correct solution
        const correctSolution = [
            ["", "N", "O", "U", "N"],
            ["H", "O", "U", "S", "E"],
            ["O", "W", "N", "E", "R"],
            ["M", "A", "C", "R", "O"],
            ["E", "Y", "E", "S", ""],
        ];

        // Check if the entered letter matches the correct solution
        return correctSolution[i][j] === letter;
    }
    function isPuzzleFilled() {
        for (let i = 0; i < 5; i++) {
            for (let j = 0; j < 5; j++) {
                const cell = document.getElementById(`i${i}_${j}`);
                if (!cell.disabled && cell.value === "") {
                    return false; // Found an empty cell
                }
            }
        }
        return true; // All cells are filled
    }
    function checkSolution() {
        let isCorrect = true;
        for (let i = 0; i < 5; i++) {
            for (let j = 0; j < 5; j++) {
                const cell = document.getElementById(`i${i}_${j}`);
                if (!cell.disabled) {
                    const expectedLetter = getExpectedLetter(i, j);
                    if (cell.value !== expectedLetter) {
                        isCorrect = false;
                        break;
                    }
                }
            }
            if (!isCorrect) break;
        }
    
        if (isCorrect) {
            showCongratsPopup();
            startConfetti();
        } else {
            showTryAgainPopup();
            stopConfetti();
        }
    }

    function getExpectedLetter(i, j) {
        // Define the correct solution
        const correctSolution = [
            ["", "N", "O", "U", "N"],
            ["H", "O", "U", "S", "E"],
            ["O", "W", "N", "E", "R"],
            ["M", "A", "C", "R", "O"],
            ["E", "Y", "E", "S", ""],
        ];
        return correctSolution[i][j];
    }
    

    function handlePuzzleCompletion(isCorrect) {
        

      
    }

    function showWinModal() {
        document.getElementById("myModal").style.display = "block";
        document.getElementById("myModal").focus();
    }

  
   function showCongratsPopup() {
            const completionTime = document.getElementById("timerDisplay").textContent;
            document.getElementById("completionMessage").textContent = `You have successfully completed the crossword in ${completionTime}`;
            document.getElementById("modalOverlay").style.display = "block";
            document.getElementById("congratsModal").style.display = "block";
            clearInterval(timerInterval); // Stop the timer

            // Get the player's name (ensure it's not empty)
            const playerName = document.getElementById("userNameDisplay").textContent;

            // Check if leaderboardRef is defined (Firebase is initialized)
            if (typeof leaderboardRef !== 'undefined') {
                // Save the result to Firebase
                leaderboardRef.push({
                    name: playerName,
                    time: completionTime,
                    timestamp: new Date().toUTCString() // Add the timestamp in UTC string format
                })
                .then(() => {
                    console.log("Leaderboard entry saved successfully!");
                })
                .catch((error) => {
                    console.error("Error saving leaderboard entry:", error);
                    // Display an error message to the user if needed
                    alert("An error occurred while saving your score. Please try again.");
                });
            } else {
                console.error("Firebase is not initialized. Leaderboard entry not saved.");
                alert("An error occurred. Please check your Firebase setup.");
            }
        }
    function showTryAgainPopup() {
        document.getElementById("modalOverlay").style.display = "block";
        document.getElementById("tryAgainModal").style.display = "block";
        // Don't pause the timer here
    }
    
    function hideTryAgainPopup() {
        document.getElementById("modalOverlay").style.display = "none";
        document.getElementById("tryAgainModal").style.display = "none";
        // Timer continues running in the background
    }

    function gotoLeaderboard() {
        // Placeholder for leaderboard URL
        window.location.href = "leaderboard.html"; // Replace with your actual leaderboard URL
    }
    
    // --- Timer Functions ---
    function togglePause() {
        isPaused = !isPaused;
        if (isPaused) {
            clearInterval(timerInterval);
            pausedTime = new Date() - startTime; // Calculate elapsed time before pausing
            document.getElementById("pauseModal").style.display = "flex";
        } else {
            resumeGame();
        }
    }

    function resumeGame() {
        document.getElementById("pauseModal").style.display = "none";
        document.getElementById("modalOverlay").style.display = "none";
        document.getElementById("congratsModal").style.display = "none";
        
    
        // Only resume the timer if the game was previously paused and not completed
        if (isPaused) {
            startTime = new Date() - pausedTime; // Adjust start time to resume from paused time
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
            isPaused = false;
            pausedTime = 0; // Reset paused time
        }
    }
    

    function updateTimerDisplay() {
        const currentTime = new Date();
        const elapsedTime = Math.floor((currentTime - startTime) / 1000);
        const minutes = Math.floor(elapsedTime / 60).toString().padStart(2, "0");
        const seconds = (elapsedTime % 60).toString().padStart(2, "0");
        document.getElementById("timerDisplay").textContent = `${minutes}:${seconds}`;
    }

    function startTimer() {
        startTime = isPaused ? new Date() - pausedTime : new Date(); // Start time depends on whether the game was paused
        updateTimerDisplay();
        timerInterval = setInterval(updateTimerDisplay, 1000);
    }

      function startGame() {
            const name = document.getElementById("nameInput").value;
            document.getElementById("userNameDisplay").textContent = name;
            document.getElementById("overlay").style.display = "none";
            startTimer();
            // You might want to add a check here:
           
        }
    function adjustSizes() {
        const windowWidth = window.innerWidth;
        const windowHeight = window.innerHeight;
      
        // Determine container width based on screen size
        const containerWidth = Math.min(390, windowWidth * 0.9);
        const cellSize = containerWidth / 5;
      
        // Set table size
        const table = document.getElementById("table");
        table.style.width = `${containerWidth}px`;
        table.style.height = `${containerWidth}px`; // Assuming a square table
      
        // Adjust cell size based on table size
        const cells = document.querySelectorAll("#table .cell");
        cells.forEach((cell) => {
          cell.style.width = `${cellSize}px`;
          cell.style.height = `${cellSize}px`;
        });
      
        // Update hint container width to match the table width
        document.getElementById("hint-container").style.width = `${containerWidth}px`;
      }
      

    // --- Initialization ---
    window.onload = function () {
        setInterval(animTutorial, 2000);
        initializeGame(); 
        adjustSizes();
        window.addEventListener("resize", adjustSizes);
    };

    document.addEventListener("scroll", () => {
        window.scrollTo(0, 0);
    }, { passive: false });

    // --- Prevent Zooming and Scrolling ---
    (function () {
        const disableZoom = () => {
            document.addEventListener("gesturestart", (e) => e.preventDefault());
            document.addEventListener("gesturechange", (e) => e.preventDefault());
            document.addEventListener("gestureend", (e) => e.preventDefault());
            document.addEventListener("keydown", (e) => {
                if ((e.ctrlKey || e.metaKey) && ["+", "-", "0"].includes(e.key)) {
                    e.preventDefault();
                }
            });
            document.addEventListener('dblclick', (e) => e.preventDefault());

            let viewportMetaTag = document.querySelector("meta[name='viewport']");
            if (!viewportMetaTag) {
                viewportMetaTag = document.createElement('meta');
                viewportMetaTag.name = 'viewport';
                document.head.appendChild(viewportMetaTag);
            }
            viewportMetaTag.content = 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no';
        };

        const disableScrolling = () => {
            const preventDefault = (e) => e.preventDefault();
            window.addEventListener('wheel', preventDefault, { passive: false });
            window.addEventListener('touchmove', preventDefault, { passive: false });
            window.addEventListener('keydown', (e) => {
                const keys = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'PageUp', 'PageDown', 'Home', 'End', ' '];
                if (keys.includes(e.key)) {
                    e.preventDefault();
                }
            });

            document.documentElement.style.position = 'fixed';
            document.documentElement.style.overflow = 'hidden';
            document.documentElement.style.width = '100%';
            document.documentElement.style.height = '100%';

            document.body.style.position = 'fixed';
            document.body.style.overflow = 'hidden';
            document.body.style.width = '100%';
            document.body.style.height = '100%';
            document.body.style.margin = '0';
        };

        disableZoom();
        disableScrolling();
    })();
  </script>
<style>

 html, body {
            overflow: hidden; /* Prevent vertical and horizontal scrolling */
            margin: 0;       /* Remove default margin to avoid unexpected shifts */
            height: 100%;    /* Ensure the body fills the viewport */
            width: 100%;     /* Ensure no unintended horizontal overflow */
       
        }
* {
    font-family: Verdana;
    font-size: 20px;
}
/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
 width: 80%;
 
  
}

/* Modal Content */
.modal-content {
  

background-color:white;
  

}



/* The Close Button */
.close {
  color: #99DAFF;
  float: right;
  font-size: 28px;
  font-weight: bold;
}



.cell {

    border-radius: 0;
    outline: none;
    border: none;
    text-align: center;
    font-size: 40px;
    opacity: 1;
   
    -webkit-text-fill-color: black;
    box-sizing: border-box; /*Ensure padding and border don't affect size*/
    padding: 0;
    padding-top: 15px;
    
}

.black-cell {
    background-color: black !important;
}
.cell-number {
    position: absolute;
    top: 1px;
    left: 2px;
    font-size: 22px;
    color: black;
}

.topnav {
position: relative;
z-index: 10;
width: 100%;
padding-top: 10px;
padding-bottom: 10px;
max-width: 500px;
  background-color: white;

    background-color: #fff;
    border-bottom: 1.5px solid #ececec;
    height: 23px;
 
     margin-left: auto; /* Add horizontal margin */
    margin-right: auto; /* Add horizontal margin */
}



html, body {
    margin: 0;
    padding: 0;
    box-sizing: border-box; /* Use border-box model for consistent sizing */
   height: 100%; /* Ensure body occupies 100% of viewport height */
     overflow: hidden; /* Disable both vertical and horizontal scrolling */
     background-color: black;
}
/* Modified Styles */
#hint-container {
z-index: 2;
position: relative;
    top: 0px;
    display: flex;
    align-items: center     ; /* Vertically center items */
    
  
    width: 100% !important;
    background-color: #99DAFF; /* Light blue background color */
    padding: 3px; /* Add some padding */
     overflow: hidden; /* Disable both vertical and horizontal scrolling */
     height: 38px;
     max-width: 495px;
       margin-left: auto; /* Add horizontal margin */
    margin-right: auto; /* Add horizontal margin */
}

#hint-text {
     width: 100%;
    font-size: 12px;
    
    
    
    text-align: left;     
     margin-left: 5px; /* Add horizontal margin */
    margin-right: 10px; /* Add horizontal margin */
}

#prev-hint {
    font-size: 17px;
    
    cursor: pointer;
     font-weight: bold;
    background-color: transparent; /* Remove button background color */
    border: none; 
    font-weight: bold;
    flex-shrink: 0; /* Prevent buttons from shrinking */
    color: black;
}
#next-hint {
    font-size: 16px;
    margin-right: 7px;
    
    cursor: pointer;
    background-color: transparent;
    border: none; /* Remove button border */
    font-weight: bold;
    flex-shrink: 0; /* Prevent buttons from shrinking */
    color: black;
}
#keysize1 {
 z-index: 10;
  position: fixed;
  bottom: 0px;
  width: 100%;
  padding-top: 25px;
  height: 200px;
  background-color: #ececec !important;
  display:block;
  justify-content: center;
}


#keyboard {

    height: 250px;
    display: flex;
    flex-direction: column;
    justify-content: space-between; 
    width: 100% !important;
    background-color: #ececec !important;
    margin-left: auto;
    margin-right: auto;
    box-sizing: border-box;
    padding-top: 17px;
    padding-bottom: 100px;
    padding-right: 5px;
    padding-left: 5px;
    position: relative;
    top: 0px;
    max-width: 500px;
   
   
}

.keyboard-row {
    display: flex;
    justify-content: center;
   
   
}

#keyboard button {
    
  
    height: 42px;
    margin: 1px;
     font-weight: 500;
    margin-bottom: 8px;
    font-size: 22px;
    text-align: center !important;
    border: 1px solid #e3e3e3;
    background-color: white;
    cursor: pointer;
    border-radius: 5px;
    color: black;
    padding: 0;
    width: 9.5%;
    font-weight: 500;
    max-width: 40px;
}

#keyboard button:hover {
    background-color: #e0e0e0;
}
/* Style for the crossword table to match keyboard width*/
#table {
position: relative;
top: -15px !important;

 width: 90% !important;
 max-width: 390px;
  border-collapse: collapse; /* Required to stop table growing*/
  border: 3px solid black; /* Thicker outer border */
  margin-left: auto;
  margin-right: auto;
}

 

#table td {

    border: 1px solid gray; /* Thinner inner borders */
    padding: 0;

}
  #overlay {
            position: fixed;
            top: 0;
            left: 0;
            
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000; /* Ensure it's on top */
        }
        #popup {
            background-color: white;
            padding-top: 30px;
            border-radius: 10px;
            text-align: center;
            max-width: 495px; /* Limit width */
             width: 100%; /* Make it responsive */
             bottom:0px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: absolute;
            
            height: 500px;;
        }
         #popup label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            padding-left: 20px;
            padding-right: 20px;
          }
          #popup input[type="text"] {
            padding: 10px;
            border: 1px solid #575757;
            border-radius: 5px;
            margin-bottom: 15px;
            width: 80%;
             font-size: 16px;
            box-sizing: border-box;
            background-color: lightgrey;
        }
        #popup button {
            background-color: #99DAFF;
            color: black;
            padding: 12px 20px;
             font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #popup button:hover {
            background-color: #FFD800;
        }
        
        #whole {
        margin-left: auto;
        margin-right: auto;
           width: 100%;
           height: 100%;
           max-width: 495px;
           border-left: 1px solid lightgrey;
           background-color: white;
           border-right: 1px solid lightgrey;
        }
</style>

</html>
